let gigyaUtilsLubs={init:function(){var e=$("#recaptchaID").val(),o=window.location.href,s=document.getElementById("sendPasswordResetEmail"),r=document.getElementById("socialLogin");null!=s&&s.addEventListener("click",this.resetPassword,!1),null!=r&&r.addEventListener("click",this.resetPasswordModal,!1),gigyaUtilsLubs.events(e,o),gigyaUtilsLubs.checkUserIsLogged()},events:function(e,o){$("#login").click(function(e){e.preventDefault(),RepsolRecaptcha.checkCaptcha(".login-form"),gigyaUtilsLubs.login()})},login:function(){var e=document.getElementById("username").value,o=document.getElementById("password").value;null!=e&&null!=o&&(e={loginID:e,password:o,callback:validateLogin},$("#login").hasClass("btn-disabled")||(loginLayer.setLoader(!0,$(".login-form")),gigya.accounts.login(e)))},logout:function(){if(window.gigya)return new Promise(function(o,s){gigya.accounts.logout({callback:function(e){0==e.errorCode?(e=Repsol.utils.getData("DLaccount"),Repsol.utils.removeData("DLaccount"),o(e)):s()}})})},onLogoutReload:function(e){location.reload(),Repsol.utils.setLoader(!1,$(document).find("body"))},showAccountInfo:function(){window.gigya&&gigya.accounts.getAccountInfo({include:"profile,data,preferences",callback:getAccountInfoResponse})},showAccountInfoDL:function(){window.gigya&&gigya.accounts.getAccountInfo({include:"profile,data,preferences",callback:getAccountInfoResponseDL})},checkUserIsLogged:function(){window.gigya&&gigya.accounts.getAccountInfo({include:"profile,data,preferences",callback:checkGigyaLogin})},resetPassword:function(e){e.preventDefault();$("form.recovery-password-form");var e=$("form.recovery-password-form").find("input[id='email']"),o=!1;e.length&&(Repsol.forms.validateFilledInput(e)?(e.parent().removeClass("error"),e.parent().find(".error-msg-required").addClass("d-none"),Repsol.forms.validateEmail(e)?(o=!0,e.parent().removeClass("error"),e.parent().find(".error-msg-format").addClass("d-none")):(e.parent().find(".error-msg-format").removeClass("d-none"),e.parent().addClass("error"))):(e.parent().find(".error-msg-required").removeClass("d-none"),e.parent().addClass("error"))),o?($("form.recovery-password-form").closest(".form-ecommerce-content").attr("data-status","ok"),loginLayer.pushResetPassword(),gigya.accounts.resetPassword({loginID:document.getElementById("email").value,callback:getResetInfoResponse}),$("#sendEmailRecovery").modal("show")):loginLayer.errorResetPassword()},resetPasswordModal:async function(e){e.preventDefault();$("form.recovery-password-form-modal");var e=$("form.social-email").find("input[id='socialEmail']"),o=!1;e.length&&(Repsol.forms.validateFilledInput(e)?(e.parent().removeClass("error"),e.parent().find(".error-msg-required").addClass("d-none"),Repsol.forms.validateEmail(e)?(o=!0,e.parent().removeClass("error"),e.parent().find(".error-msg-format").addClass("d-none")):(e.parent().find(".error-msg-format").removeClass("d-none"),e.parent().addClass("error"))):(e.parent().find(".error-msg-required").removeClass("d-none"),e.parent().addClass("error"))),o&&(null!=(e=await gigyaUtilsLubs.searchaccount()).results[0]&&null!=e.results[0].password&&null==e.results[0].password.created?($("form.recovery-password-form").closest(".form-ecommerce-content").attr("data-status","ok"),RpAlert.msgOK(document.getElementById("ok-message-email").value),gigya.accounts.resetPassword({loginID:document.getElementById("socialEmail").value,callback:getResetInfoResponse})):RpAlert.msgError(document.getElementById("ko-message-email").value))},searchaccount:async function(){var e=document.getElementById("socialEmail").value,e="/bin/repsol/gigya/searchaccount.json?email="+encodeURIComponent(e);try{var o=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});if(o.ok)return await o.json();throw new Error("Network response was not ok")}catch(e){throw console.error("Fetch error:",e),e}},setNewPassword:function(e){var o=e.newPassword;gigya.accounts.resetPassword({newPassword:o,passwordResetToken:e.passwordResetToken,callback:e.callback})},checkPasswords:function(){window.gigya&&document.getElementById("enter-password").value===document.getElementById("confirm-password").value?alert("passwords are ok!"):alert("passwords are not ok!")},services:{getType:function(){return window.location.pathname.indexOf("/pymes1/")?"BTB":"BTC"},addTemplate:function(e,o){var s,r=null;return s=null!=(r="noresults"!=o?gigyaUtilsLubs.services.getSource():gigyaUtilsLubs.services.getSourceEmpty())?Handlebars.compile(r)(e):s},getSource:function(){return'<div class="col-12 col-md-4 block-margin-s"><article class="card-ecommerce card-es-info text-fragment {{this.active}}" data-component="{{this.component}}"><div class="block-header"><div class="icon rp-icon-simple"><div class="rp-icon"><span class="{{this.icon}}"></span></div></div><div class="block-content"><div class="rp-title-1">{{this.name}}</div><div class="rp-body-1">{{{this.description}}}</div><div class="link"><a class="rp-link rp-link-click" target="_blank" href="{{this.linkUrl}}"><span>{{this.privateLinkTxt}}</span><span class="rp-arrow icon-rp-Arrow_right"></span></a></div></div></div></article></div>'},getSourceEmpty:function(){return'<div class="col-12 col-md-4 block-margin-s"><article class="card-ecommerce card-es-info text-fragment no-results" data-component="{{this.component}}"><div class="block-header"><div class="icon rp-icon-simple"><div class="rp-icon"><span class="{{this.icon}}"></span></div></div><div class="block-content"><div class="rp-title-1">{{this.name}}</div><div class="rp-body-1">{{{this.description}}}</div></div></div></article></div>'},checkDaSegServices:function(e,s){var r=!1;return $.each(e,function(e,o){if(-1!==e.toLowerCase().indexOf(s.toLowerCase())&&e===o)return!(r=!0)}),r},setDropdownLayout:function(e){var o=Math.random().toString(36).substring(7),o='<div class="rp-dropdown dropdown dropdown-digital-services"><a class="dropdown-toggle" data-toggle="collapse" href="#collapse'+o+'" role="button" aria-expanded="false" aria-controls="collapseDigitalServices">'+e.attr("data-collapse-text")+'</a><div class="collapse collapse-digital-services" id="collapse'+o+'"><div class="remain-services digital-services-list row block-container"></div></div></div>';e.closest(".distributive-es-basic-component").find("> .container").append(o),e.find(".remain-services").collapse("hide")},checkEmailExist:function(e){return new Promise((o,s)=>{gigya.accounts.isAvailableLoginID({loginID:e,callback:e=>{0===e.errorCode?o(e.isAvailable):s(new Error("Error al verificar el email"))}})})}},setCookie:function(e,o){document.cookie=e+"="+o+"; expires=0; path=/"},checkIslogged:function(e){return 0===e},getLoggedUserType:function(){let e=document.getElementById("textUserType"),o;return null!=e?o=null!=e?e.innerHTML:void 0:null!=document.querySelector(".rp-lubricantes-page")?o=JSON.parse(localStorage.getItem("user"))?.user_type:void 0},setUserTypeStorage:function(){var e=gigyaUtilsLubs.getLoggedUserType();null!=e&&window.sessionStorage.setItem("loggedUserType",e)}};function validateLogin(s){var r=s.errorCode;if(0===r){var t=$("#loginLandingPage").attr("data-landing-page");gigyaUtilsLubs.setCookie("isLogged",gigyaUtilsLubs.checkIslogged(r)),gigyaUtilsLubs.setCookie("isLoggedFirstTime",!0);let e=!1,o=(s&&s.profile?(s.profile.firstName?gigyaUtilsLubs.setCookie("username",", "+s.profile.firstName):gigyaUtilsLubs.setCookie("username",""),e=!0):(s||s.user)&&(s.user.firstName?(gigyaUtilsLubs.setCookie("username",", "+s.user.firstName),e=!0):gigyaUtilsLubs.setCookie("username","")),Repsol.Analytics.clickLogin(),"");o="Profesional"==s.data.PortalPublicoLubricantes.TipoCliente?"Profesional_Taller":s.data.PortalPublicoLubricantes.TipoCliente;var a={method:"Site",component_name:"card de login",customer_type:Repsol.AnalyticsRomProd.Getters.getLoggedUserType(),funnel_action:"login_ok",funnel_step:"1",funnel_type:"login",service:"Lubricants",customer_type:o,user_services:"Lubricants"};Repsol.AnalyticsRomProd.AccountLoginRomProd($(".login-form"),a),$(location).attr("href",t),loginLayer.setLoader(!1,$(".login-form"))}else 403042===r?(loginLayer.setLoader(!1,$(".login-form")),RpAlert.msgError($(".login-form").attr("data-msg-error")),$("body").hasClass("alerts-on-top--header-layer")&&$("body").removeClass("alerts-on-top--header-layer"),$("body").addClass("alerts-login"),a={method:"Site",component_name:"card de login",customer_type:Repsol.AnalyticsRomProd.Getters.getLoggedUserType(),funnel_action:"login_ko",funnel_step:"1",account_action:"login",funnel_type:"login",service:"lubricantes",error_type:"form_error",error_description:"Usuario | Contraseña Incorrecto"},Repsol.AnalyticsRomProd.AccountErrorRomProd($(".login-form"),a)):206002===r?(t=document.getElementById("modalLoginLub"),a=document.getElementById("modalPendingVerification"),loginLayer.getEmailModal(s.profile.email),t.classList.add("hidden"),a.classList.remove("hidden"),document.getElementById("loginSocial").classList.add("hidden"),r=loginLayer.getUserPassword(),RepsolRegister.getInfoUser(s.profile.email,s.UID,r),RepsolRegister.resendCode()):(loginLayer.setLoader(!1,$(".login-form")),gigyaUtilsLubs.setCookie("username",""),RpAlert.msgError($(".login-form").attr("data-msg-error")),$("body").hasClass("alerts-on-top--header-layer")&&$("body").removeClass("alerts-on-top--header-layer"),$("body").addClass("alerts-login"),gigyaUtilsLubs.logout());loginLayer.setLoader(!1,$(".login-form"))}function getAccountInfoResponse(l){if(console.log("Account Info Response"),0===l.errorCode){console.log("ErrorCode distinto de cero");let e,o,s,r,t,a,n,i;var c=$(".digital-services-list").attr("data-resourcePath");console.log("Resource Path: {}",c),null!=c&&(c.includes("repsol-corporate")?(e={url:c,method:"GET",timeout:0},c=JSON.parse(sessionStorage.getItem("user")),o=c.user_services,s=c.legal_terms,r=c.da_seg,t=c.wally,a=c.loyalty,n=c.guide_repsol,i=c.mi_solred):(e={url:"/bin/repsol/digital-services",method:"GET",timeout:0},o=l.data.Service,s=l.data.LegalTerms,r=l.data.DaSeg,t=!!(l.preferences&&l.preferences.Terms&&l.preferences.Terms.Wally&&l.preferences.Terms.Wally.isConsentGranted)&&l.preferences.Terms.Wally.isConsentGranted,a=!!(l.preferences&&l.preferences.Terms&&l.preferences.Terms.Loyalty&&l.preferences.Terms.Loyalty.isConsentGranted)&&l.preferences.Terms.Loyalty.isConsentGranted,n=!!(l.preferences&&l.preferences.Terms&&l.preferences.Terms.GuiaRepsol&&l.preferences.Terms.GuiaRepsol.isConsentGranted)&&l.preferences.Terms.GuiaRepsol.isConsentGranted,i=1==l?.data?.Service?.Solred2&&1==l?.preferences?.Terms?.Solred2?.isConsentGranted,(l?.data?.Service?.Inversores||l?.preferences?.Consent?.Inversores?.BAJACOMUNICACIONES?.isConsentGranted)??!1?o.hasOwnProperty("Inversores")||(o.Inversores=!0):(s=s&&Object.fromEntries(Object.entries(s).filter(([e])=>"Inversores"!==e)),o.hasOwnProperty("Inversores")&&delete o.Inversores)),$.ajax(e).done(function(e){Repsol.Analytics.ES.showAccount(l);var o=Repsol.Analytics.getCookie("isLoggedFirstTime");"true"==o&&null!=o&&(Repsol.Analytics.ES.login.loadClientArea(l.socialProviders),gigyaUtilsLubs.setCookie("isLoggedFirstTime",!1))}))}else{RpAlert.msgError($(".digital-services-list").attr("data-error-services")),$("body").hasClass("alerts-on-top--header-layer")&&$("body").removeClass("alerts-on-top--header-layer"),$("body").addClass("alerts-login"),Repsol.utils.setLoader(!1,$(".distributive-es-basic-component")),Repsol.utils.removeData("DLaccount"),gigyaUtilsLubs.setCookie("userType",gigyaUtilsLubs.services.getType()),gigyaUtilsLubs.setCookie("username",""),gigyaUtilsLubs.setCookie("isLogged",!1);var c=$(document).find(".header-ecom-logged").attr("data-target-b2c")||$(document).find(".login-component").attr("data-target-b2c"),e=headerUser.getCookie("isLogged");location.href.indexOf("/content/repsol-ecommerce")<0&&("true"!==e||"null"===e)&&$(location).attr("href",c)}}function getAccountInfoResponseDL(e){0===e.errorCode?Repsol.Analytics.ES.showAccount(e):console.log("AccountInfo response error")}function getResetInfoResponse(e){0===e.errorCode?console.log("Reset email has been sent."):console.log(e)}function setInfoUser(e){sessionStorage.setItem("infoUser",JSON.stringify(e))}function showModal(){$(".register-login-modal-component").modal("show"),$(".register-login-modal-backdrop").modal("show")}function closeModal(){$(".close, .register-login-modal-backdrop").on("click",function(){$(".register-login-modal-component").modal("hide"),$(".register-login-modal-backdrop").modal("hide")})}function checkGigyaLogin(e){var o=Repsol.utils.getCookie("isLogged");0!==e.errorCode&&"true"===o&&(headerUser.deleteUserCookies(),$(".header-user").is(":visible")?(o=$(document).find(".header-ecom-logged").attr("data-target-b2c")||$(document).find(".login-component").attr("data-target-b2c"),window.location.href=o):window.location.reload()),0===e.errorCode&&(gigya.accounts.getAccountInfo({callback:setInfoUser(e)}),(o=jQuery.parseJSON(sessionStorage.getItem("infoUser"))).data.Service.hasOwnProperty("PortalLubricantes")||(showModal(),loginLayer.setInfoUserOtherService(o),loginLayer.showModalRegisterLub(),closeModal()),console.log("El login en gigya ha sido satisfactorio"))}$(document).ready(function(){gigyaUtilsLubs.init()});
var loginLayer={url:"/bin/repsol/gigya/register.json",controller:null,init:function(){loginLayer.events(),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?$(".login-component.layer-login").addClass("fix-login-scroll-iphone"):$(".login-component.layer-login").removeClass("fix-login-scroll-iphone")},events:function(){$(document).find(".layer-login");$(".layer-login-inner").keypress(function(e){"13"==(e.keyCode||e.which)&&(e.preventDefault(),$("#username").val())&&$("#password").val()&&gigyaUtilsLubs.login()}),$(document).on("input",".login-form input",function(){$("#username").val()&&$("#password").val()?$(".login-form").find(".rp-btn-turquoise.btn-disabled").removeClass("btn-disabled"):$(".login-form").find(".rp-btn-turquoise").addClass("btn-disabled")}),$(document).on("input",".recovery-password-form input",function(){$("#email").val()?$(".recovery-password-form").find(".rp-btn-turquoise.btn-disabled").removeClass("btn-disabled").removeAttr("disabled"):($(".recovery-password-form").find(".rp-btn-turquoise").addClass("btn-disabled").prop("disabled","true"),$(".recovery-password-form").find(".rp-input-repsol .error").removeClass("error"),$(".recovery-password-form").find(".rp-input-repsol .error-msg-format").addClass("d-none"))}),$(".login-form").on("blur","input[name='password']",function(){Repsol.forms.validate.InputPassword($(this),!1)}),$(document).on("click",".js-show-password",function(){loginLayer.showPassword($(this))}),loginLayer.changeUsertype()},getCookie:function(e){for(var t=e+"=",r=decodeURIComponent(document.cookie).split(";"),o=0;o<r.length;o++){for(var n=r[o];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},showPassword:function(e){var t=e.parent().find("input"),r="icon-rp-Eye_Open";iconHidden="icon-rp-Eye_close","password"==t.attr("type")?(t.attr("type","text"),e.find(".rp-icon").removeClass(iconHidden).addClass(r)):(t.attr("type","password"),e.find(".rp-icon").removeClass(r).addClass(iconHidden))},setLoader:function(e,t){var r=$(document).find("body");0<t.closest(".modal").length&&(r=t.closest(".modal")),Repsol.utils.setLoader(e,r)},getUserPassword:function(){return document.querySelector("input[name='password']").value},getEmailModal:function(e){document.getElementById("email-reference-login").textContent=e},setInfoUserOtherService:function(e){document.getElementById("emailRegisterLub").value=e.profile.email,document.getElementById("nameRegisterLub").value=e.profile.firstName},showModalRegisterLub:function(){document.getElementById("modalRegisterLub").hidden=!1,document.getElementById("loginSocial").hidden=!0,document.getElementById("modalLoginLub").hidden=!0},changeUsertype:function(){$("form.register-form-lub").each(function(){$(this).find("#user-typeLub").change(function(){("Profesional_Taller"===$("#user-typeLub").val()?($(".profesional").parent(".input.rp-input-repsol").removeClass("d-none"),$(".distributor")):("Distribuidor_Cliente"===$("#user-typeLub").val()?$(".distributor").parent(".input.rp-input-repsol").removeClass("d-none"):$(".distributor").parent(".input.rp-input-repsol").addClass("d-none"),$(".profesional"))).parent(".input.rp-input-repsol").addClass("d-none")})})},closeModal:function(){$(".close, .register-login-modal-backdrop").on("click",function(){$(".register-login-modal-component").modal("hide"),$(".register-login-modal-backdrop").modal("hide")})},registerUserLubricantes:function(){var e=$(document).find("#modalRegisterLub"),t=e.find("input[name='name']"),r=e.find("input[name='surname']"),o=e.find("select[name='countryLub']"),n=e.find("select[name='user-typeLub']"),t=(t.length&&Repsol.forms.validate.InputName(t),r.length&&Repsol.forms.validate.InputSurname(r),o.closest(".cmp-form")),r=(""!==o.val()?(t.find(".error-msg-required").addClass("d-none"),o.attr("data-status","true"),t.addClass("valid"),t.removeClass("error")):(t.find(".error-msg-required").removeClass("d-none"),o.attr("data-status","false"),t.removeClass("valid"),t.addClass("error")),n.closest(".cmp-form")),a=(""!==n.val()?(n.attr("data-status","true"),r.find(".error-msg-required").addClass("d-none"),r.addClass("valid"),r.removeClass("error")):(n.attr("data-status","false"),r.find(".error-msg-required").removeClass("d-none"),r.removeClass("valid"),r.addClass("error")),n.length&&(r=(t=e.find("input[name='ctc']")).closest(".cmp-form"),a=e.find("input[name='userCode']"),r.find(".error-msg-required").addClass("d-none"),"Profesional_Taller"===n.val()?(a.attr("data-status",!1),t.attr("data-status",!0),""!==a.val()?(a.attr("data-status",!0),r.addClass("valid"),r.removeClass("error")):(a.attr("data-status",!1),r.removeClass("valid"),r.find(".error-msg-format").removeClass("d-none"),r.addClass("error"))):"Distribuidor_Cliente"===n.val()?(a.attr("data-status",!0),t.attr("data-status",!1),""!==t.val()&&t.val().length<11?(t.attr("data-status",!0),r.addClass("valid"),r.removeClass("error")):(t.attr("data-status",!1),r.removeClass("valid"),r.find(".error-msg-format").removeClass("d-none"),r.addClass("error"))):(n.attr("data-status",!1),r.removeClass("valid"),r.find(".error-msg-format").removeClass("d-none"),r.addClass("error"))),"true"===e.find("input[name='name']").attr("data-status")),t="true"===e.find("input[name='surname']").attr("data-status"),r="true"===o.attr("data-status"),o="true"===n.attr("data-status");let s=a&&t&&r&&o?!0:!1;s?(e.closest(".form-ecommerce-content").attr("data-status","ok"),RepsolRegister.sendDataRegisterUserLubricantes(e)):RepsolRegister.analytics.error(e)},sendDataRegisterUserLubricantes:function(){var e=jQuery.parseJSON(sessionStorage.getItem("infoUser")),t=document.getElementById("nameRegisterLub").value,r=document.getElementById("surnameRegisterLub").value,o=$("select[name='countryLub']").val(),n=$("select[name='countryLub']").find("option:selected").data("id"),a=document.getElementById("user-typeLub").value,s=document.getElementById("userCodeLub").value,i=document.getElementById("ctcLub").value,e=($("html").attr("lang"),{UID:e.UID,operation:"update",email:e.profile.email,firstName:t,lastName:r,country:o,countryID:n,userType:a,ctc:i,userCode:s});$.ajax({method:"POST",url:loginLayer.url,contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:function(e){0==e.errorCode&&(RpAlert.msgOK($("#formRegisterLub").attr("data-msg-success")),setTimeout(function(){location.reload()},3e3)),2==e.errorCode&&(e=Granite.I18n.get("register-insert-valid-ctc"),$("#formRegisterLub").attr("data-msg-error",e),RpAlert.msgError($("#formRegisterLub").attr("data-msg-error")))},error:function(e,t){RpAlert.msgError($("#formRegisterLub").attr("data-msg-error"))}})},pushForgetPassword:function(){Repsol.AnalyticsRomProd.clickInteractionRomProd($("#redirectForgetPassword"),{component_catalogue:"false",component_description:"Login Form",component_name:"card de login",content_name:"Bienvenido al Portal Lubricantes Repsol",element_description:"open recover password",element_type:"text",link_text:"Olvide mi contraseña"})},pushResetPassword:function(){Repsol.AnalyticsRomProd.clickInteractionRomProd($("#sendPasswordResetEmail"),{component_catalogue:"false",component_description:"Password Recovery",component_name:"card de reset password",content_name:"Bienvenido al Portal Lubricantes Repsol",element_description:"send email recover password",element_type:"Button",link_text:"Enviar"})},errorResetPassword:function(){var e={method:"site",account_action:"profile update",component_name:"reset password",error_type:"correo electronico",error_description:"contact form | campo obligatorio",funnel_action:"password_reset_ko",customer_type:void 0,funnel_step:"01",funnel_type:"password_reset",service:"lubricantes"};Repsol.AnalyticsRomProd.AccountErrorRomProd($("#sendPasswordResetEmail"),e)},pushHelpLogin:function(){var e=document.querySelector("#linkHelpLogin a").getAttribute("href"),e={component_catalogue:"false",component_description:"Login Form",component_name:"card de login",content_name:"Bienvenido al Portal Lubricantes Repsol",link_domain:e,link_is_cta:"false",link_text:"¿Has tenido algun problema o necesitas ayuda?",link_type:"navigation",link_url:e};Repsol.AnalyticsRomProd.linkClickRomProd($("#linkHelpLogin"),e)},pushRegister:function(e,t){e={method:"site",component_catalogue:"false",component_description:"Register Login Form",component_name:"card de register",customer_type:e,funnel_action:"register_ok",funnel_step:"01",funnel_type:"register_long",service:"Lubricants",user_identity:e+" / "+t};Repsol.AnalyticsRomProd.AccountRegisterRomProd($("#AccountRegisterRomProd"),e)}};$(document).ready(function(){loginLayer.init()});
