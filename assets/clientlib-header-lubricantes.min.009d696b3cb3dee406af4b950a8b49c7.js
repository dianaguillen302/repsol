var thisPromo,cardSelect,userActArr=[],screensetloginPromo="",nameId="",screensetregistrerPromo="",isAddGuide=!1;function accessUserProfile(e){console.log("LÍNEA 228 -> accessUserProfile response ",e),null!=e&&sessionStorage.setItem("infoUser",JSON.stringify(e))}function handleResultScreen(e){"finished"==e.reason?(gigya.accounts.getAccountInfo({callback:getAccountInfoResponseLubricants}),gigya.accounts.getAccountInfo({callback:getAccountInfoResponseReload})):"canceled"==e.reason&&console.log("LÍNEA 244 -> canceled screenSet")}function handlerCustomerAreaElements(e,o){(e?.querySelectorAll("#"+o)).forEach(e=>{e.classList.contains(HeaderLubricantes.props.classes.hidden)&&e.classList.remove(HeaderLubricantes.props.classes.hidden);var e=e.closest(".rp-container");e&&(e.classList.contains(HeaderLubricantes.props.classes.hidden)&&e.classList.remove(HeaderLubricantes.props.classes.hidden),e=e.parentElement)&&e.classList.contains(HeaderLubricantes.props.classes.hidden)&&e.classList.remove(HeaderLubricantes.props.classes.hidden)})}function handlerCustomAreaContainers(n){document.querySelectorAll("#"+HeaderLubricantes.props.ids.privateArea.containers.general).forEach(e=>{var o=document.querySelector("header");o&&o.closest(".isAuthor")||([...e.children].forEach(e=>{e.classList.contains(HeaderLubricantes.props.classes.hidden)||e.classList.add(HeaderLubricantes.props.classes.hidden)}),"Profesional"===n.user_type&&handlerCustomerAreaElements(e,HeaderLubricantes.props.ids.privateArea.containers.professionals),"Distribuidor"===n.user_type&&handlerCustomerAreaElements(e,HeaderLubricantes.props.ids.privateArea.containers.distributors))})}function getAccountInfoResponseLubricants(n){if(null!=n&&0==n.errorCode&&(n={username:n.profile.firstName,method:Repsol.Analytics.getMethodLogin(n),user_id:n.UID,user_services:n.data.Service,user_registration_date:n.registered,user_bulletins:null!=n.Bulletins?n.Bulletins:null,user_type:n.data.PortalPublicoLubricantes?.TipoCliente},window.sessionStorage.setItem("user",JSON.stringify(n))),null!=sessionStorage.getItem("user")){let e=JSON.parse(sessionStorage.getItem("user")),o=$("#GigyaUserBlock");o.addClass("logged-in"),0<$(".rp-login-pt").length&&$(".bottom-control.user-section").addClass("logged");var n=$("#user-area"),t=void 0===e.username?"":e.username,a=document.querySelector(HeaderLubricantes.props.selectors.containers.header).dataset.greetingsText,a=(-1<window.location.href.indexOf("/es/")?n.html('<button class="dropdown-toggle" type="button" id="dropdownUserMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="welcome">Hola </span><span class="user">'+t+"</span></button>"):"pt"===$("html").attr("lang")?n.html('<button class="dropdown-toggle" type="button" id="dropdownUserMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="welcome">Olá, </span><span class="user">'+t+"</span></button>"):n.html('<button class="dropdown-toggle" type="button" id="dropdownUserMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="welcome">'+a+' </span><span class="user">'+t+"</span></button>"),n.append('<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownUserMenuButton"></div>'),n.find(".dropdown-menu")),t=document.querySelector(HeaderLubricantes.props.selectors.logged.container),n=t?.querySelector(HeaderLubricantes.props.selectors.logged.privateArea),i=t?.querySelector(HeaderLubricantes.props.selectors.logged.miPerfil),t=t?.querySelector(HeaderLubricantes.props.selectors.logged.logout),n=n.cloneNode(!0),i=i.cloneNode(!0),t=t.cloneNode(!0);-1<window.location.href.indexOf("/es/")||$("html").attr("lang"),a.append(i),a.append(n),a.append(t),HeaderLubricantes.props.links.logout=t.href,t.href="",0<$(".header-user-pt").length&&$(".user-section").html($(".header-user-pt").html()),$(".dropdown-user .dropdown-toggle").on("click",function(e){var o=$(this);void 0!==Repsol.Analytics.COM&&Repsol.Analytics.COM.header.clickBtnLogin(o)}),$(".dropdown-user").on("show.bs.dropdown",function(e){$(this).find(".dropdown-menu").first().stop(!0,!0).show()}),$(".dropdown-user").on("hide.bs.dropdown",function(e){$(this).find(".dropdown-menu").first().stop(!0,!0).hide()}),0<$(".header-user-pt").length?($(document).off("click",".logout"),$(document).on("click",".logout",function(e){e.preventDefault(),sessionStorage.removeItem("user"),sessionStorage.removeItem("infoUser");e=$("#GigyaUserBlock").attr("data-user-authentication-method");"repsol"===e?window.location.href=o.attr("data-logout"):"gigya"===e&&window.gigya&&(Repsol.utils.setLoader(!0,$(document).find("body")),gigya.accounts.logout({callback:onLogoutReloadLubricants}))})):a.on("click",".logout",function(e){e.preventDefault(),sessionStorage.removeItem("user"),sessionStorage.removeItem("infoUser");e=$("#GigyaUserBlock").attr("data-user-authentication-method");"repsol"===e?window.location.href=o.attr("data-logout"):"gigya"===e&&window.gigya&&(Repsol.utils.setLoader(!0,$(document).find("body")),gigya.accounts.logout({callback:onLogoutReloadLubricants}))}),handlerCustomAreaContainers(e)}}function onLogoutReloadLubricants(e){window.location.href=HeaderLubricantes.props.links.logout,Repsol.utils.setLoader(!1,$(document).find("body"))}function getAccountInfoResponseReload(e){var o;null!=e&&(o=document.domain,sessionStorage.setItem("domainLogin",o),sessionStorage.getItem("domainLogin")==document.domain)&&($.removeCookie("gigyaLogged"),document.cookie="gigyaLogged=true",sessionStorage.setItem("infoUser",JSON.stringify(e)),isLogged())}function isLogged(){var e,o,n,t,a,i,s,r,c,l=sessionStorage.getItem("infoUser"),d=null;l&&"string"==typeof l&&(d=JSON.parse(l)),console.log("LÍNEA 287 -> isLogged obj",d);null!=d&&sessionStorage.getItem("domainLogin")==document.domain||null!=d&&(sessionStorage.getItem("domainLogin")!=document.domain||null==sessionStorage.getItem("domainLogin"))||null!=d&&sessionStorage.getItem("domainLogin")!=document.domain&&(sessionStorage.getItem("domainLogin"),0)?(document.cookie="gigyaLogged=true",document.cookie="uid="+JSON.parse(sessionStorage.infoUser).UID,isAddGuide||(addToMyGuide(),isAddGuide=!0),l=d.profile.firstName,a=d.profile.lastName??"",t=document.getElementById("miProfilePic").value,e=document.getElementById("miGuiaLocation").value,o=document.getElementById("miPerfilLocation").value,e=DOMPurify.sanitize(e),i=DOMPurify.sanitize(t),l=DOMPurify.sanitize(l),a=DOMPurify.sanitize(a),o=DOMPurify.sanitize(o),t=0<t.length?i:"/content/dam/repsol-guia/background-file/User.png",(i=document.createElement("a")).setAttribute("href",e),i.className="block-content",(n=document.createElement("img")).setAttribute("src",t),n.setAttribute("alt","avatar"),n.className="user-avatar",n.style.padding="0",(t=document.createElement("div")).className="rp-body-1",t.textContent=l+" "+a,(a=document.createElement("div")).className="rp-body-1 color-grey",a.textContent="Acceder a Mi guia",(s=document.createElement("span")).className="icon icon-rp-Arrow_right",i.appendChild(n),i.appendChild(t),i.appendChild(a),document.getElementById("userEmailData").appendChild(i),document.getElementById("userEmailData").appendChild(s),(n=document.getElementById("userDataPages")).innerHTML="",(t=document.createElement("div")).className="paSelector",(a=document.createElement("span")).textContent="Hola, ",(i=document.createElement("span")).className="pasUserName",i.textContent=l,(s=document.createElement("span")).className="icon-rp-Arrow_down selectorIcon",a.appendChild(i),a.appendChild(s),t.appendChild(a),(l=document.createElement("div")).className="selectorBox",(i=document.createElement("a")).setAttribute("href",e),i.className="btn__miguia",i.textContent="Mi Guía",(s=document.createElement("a")).setAttribute("href",o),s.textContent="Mi Perfil",l.appendChild(i),l.appendChild(s),n.appendChild(t),n.appendChild(l),$(".block-header-guia .block-content").css("padding-top","16px"),$(".selectorBox").css("right",$(".block-header-guia").css("margin-right")),$(".paSelector").click(function(){$(this).siblings(".selectorBox").slideToggle(),$(this).find(".selectorIcon").toggleClass("icon-rp-Arrow_up")}),$(".miGuiaAccess").hide(),$("#userDataButtonPages .rp-btn-secondary.miGuiaAccess").click(function(){window.location.href=""})):(document.cookie="gigyaLogged=false",document.cookie="uid=",(window.location.pathname.includes("/es/mi-guia")||window.location.pathname.startsWith("/es/mi-perfil"))&&(window.location.href=window.location.origin+"?login"),r=document.location.hostname,document.location.href,$("#userDataButtonPages .miGuiaAccess").click(function(){c=$(this).attr("href"),dataLayer.push({event:"menu_click",link_text:"acceder_mi_guia",link_domain:r,link_url:"#",link_type:"navigation",outbound:"false",component_name:"navigation bar",menu_name:"hamburger",event_name:"menu_click",event_category:"menu_click",event_action:"menu hamburger - acceder_mi_guia",event_label:"#"})}),$(" #userDataPages .miGuiaAccess").click(function(){c=$(this).attr("href"),dataLayer.push({event:"menu_click",link_text:"acceder_mi_guia",link_domain:r,link_url:c,link_type:"navigation",outbound:"false",component_name:"navigation bar",menu_name:"header",event_name:"menu_click",event_category:"menu_click",event_action:"menu header - acceder_mi_guia",event_label:c})})),null!=d&&($(".card--favorite .markers").each(function(e,o){$(o).hasClass("icon-rp-Turned_in_not")&&($(o).removeClass("icon-rp-Turned_in_not"),$(o).addClass("icon-rp-Turned_in"))}),$(".card .markers").each(function(e,o){$(o).click(function(){$(o).hasClass("icon-rp-Turned_in_not")&&($(o).removeClass("icon-rp-Turned_in_not"),$(o).addClass("icon-rp-Turned_in"))})}))}HeaderLubricantes={props:{selectors:{logged:{container:".logged-links-JS",privateArea:".private-area-JS",miPerfil:".mi-perfil-JS",logout:".logout-link-JS"},containers:{header:".header-container-JS"}},links:{logout:""},classes:{hidden:"hidden"},ids:{privateArea:{containers:{general:"general-container-customer-area-js",professionals:"profesionals-containers-js",distributors:"distributors-containers-js"}}}},init:function(){HeaderLubricantes.gigya.init(),HeaderLubricantes.checkIsLogged(),$("body").on("click",".mi-perfil-JS",function(e){e.stopPropagation()})},gigya:{init:function(){window.gigya&&gigya.accounts.addEventHandlers({onLogin:HeaderLubricantes.gigya.showAccountInfo}),HeaderLubricantes.gigya.showAccountInfo()},showModal:function(){$("body").on("click",".gigya-login-text",function(){var e,o=$("#GigyaUserBlock"),n=o.attr("data-user-authentication-method");"repsol"===n?location.href=o.attr("data-login"):"gigya"===n&&window.gigya&&(n={email_already_exists:o.attr("rp-catalog-login-email"),invalid_login_or_password:o.attr("rp-catalog-login-invalid"),passwords_do_not_match:o.attr("rp-catalog-login-pass"),this_field_is_required:o.attr("rp-catalog-login-required")},o={screenSet:"PortalPublicoLubricantes-RegistrationLogin",lang:HeaderLubricantes.gigya.getLanguage(),customLang:n,redirectURL:$(".header-lub").attr("data-target-private-area"),redirectMethod:"GET"},n=$(".rp-lubricantes-page"),e=$(".private-area-JS").attr("href"),n&&window.sessionStorage.getItem("user")?window.location=e:gigya.accounts.showScreenSet(o))})},closeModal:function(){$("body").on("click","#gigya-screen-dialog-page-overlay",function(){$(".gigya-screen-dialog, #gigya-screen-dialog-page-overlay").hide()}),$(".lubricantes-modal .icon.icon-rp-Cross").on("click",function(){$(".lubricantes-modal.lubricantes-modal-container").addClass("hidden")})},showAccountInfo:function(){window.gigya&&gigya.accounts.getAccountInfo({callback:getAccountInfoResponseLubricants})},getLanguage:function(){return $(document).find("html").attr("lang")}},showError:function(){$(".lubricantes-modal .input-contaier input").change(function(){$(".lubricantes-modal .obligatory-field-text").addClass("hidden"),$(".lubricantes-modal .input-contaier input").removeClass("error")}),$(".lubricantes-modal .form-section .submit-button").click(function(){""==$(".lubricantes-modal .form-section .form-email").val()&&""==$(".lubricantes-modal .form-section .form-pass").val()&&($(".lubricantes-modal .obligatory-field-text").removeClass("hidden"),$(".lubricantes-modal .input-contaier input").addClass("error"))}),$(".lubricantes-modal .forgot-pass-modal .submit-button").click(function(){""==$(".lubricantes-modal .forgot-pass-modal .form-email").val()&&($(".lubricantes-modal .forgot-pass-modal .obligatory-field-text").removeClass("hidden"),$(".lubricantes-modal .forgot-pass-modal input").addClass("error"))}),$(".lubricantes-modal .login-accept-modal .submit-button").click(function(){""==$(".lubricantes-modal .login-accept-modal .form-email").val()&&($(".lubricantes-modal .login-accept-modal .obligatory-field-text").removeClass("hidden"),$(".lubricantes-modal .login-accept-modal input").addClass("error"))})},userAct:function(){var e=sessionStorage.getItem("infoUser"),o=null;(o=e&&"string"==typeof e?JSON.parse(e):o)&&$.ajax({type:"GET",async:!1,url:"/bin/repsol-guia/promotion-subscription?userId="+o.UID,success:function(e){userActArr=e,console.log("LÍNEA 173 -> userAct response -> ",e)},error:function(e,o){console.log("Status: {}",e),console.log("Error: {}",o)}})},showForgotPassModal:function(){$(".lubricantes-modal-container .form-section .forget-pass").click(function(){$(".lubricantes-modal.lubricantes-modal-container .lubricantes-modal-content").addClass("hidden"),$(".lubricantes-modal-container .forgot-pass-modal").removeClass("hidden")}),$(".lubricantes-modal-container .back-home").click(function(){$(".lubricantes-modal.lubricantes-modal-container .lubricantes-modal-content").removeClass("hidden"),$(".lubricantes-modal-container .forgot-pass-modal").addClass("hidden")})},showLoginAcceptModal:function(){$(".lubricantes-modal-container .lubricantes-modal-content .google-link").click(function(e){e.preventDefault(),$(".lubricantes-modal.lubricantes-modal-container .lubricantes-modal-content").addClass("hidden"),$(".lubricantes-modal-container .login-accept-modal").removeClass("hidden")})},getCookie:function(e){for(var o=e+"=",e=decodeURIComponent(document.cookie),n=(console.log("LÍNEA 209 -> getCookie decodedCookie ",e),e.split(";")),t=0;t<n.length;t++){for(var a=n[t];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(o))return a.substring(o.length,a.length)}return""},checkIsLogged:function(){var e,o=$(document).find(".header-lub");"true"===o.attr("data-private-area")&&(o=o.attr("data-target-home"),e=null!=sessionStorage.getItem("user"),location.href.indexOf("/content/repsol-lubricantes")<0)&&(!0!=e||null===e)&&$(location).attr("href",o)}},$(document).ready(function(){HeaderLubricantes.init()});