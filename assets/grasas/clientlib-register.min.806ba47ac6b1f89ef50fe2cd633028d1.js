let RepsolRegister={url:"/bin/repsol/gigya/register.json",emailNotUsed:!0,vToken:"",emailBackUp:"",uid:"",passBackUp:"",user_identity:"",init:function(){RepsolRegister.events()},events:function(){$("form.register-form").each(function(){let s=$(this);s.find("input").change(function(){RepsolRegister.checkContent(s)}),s.find("#userType").change(function(){("Profesional_Taller"===$("#userType").val()?($(".profesional").parent(".input.rp-input-repsol").removeClass("d-none"),$(".distributor")):("Distribuidor_Cliente"===$("#userType").val()?$(".distributor").parent(".input.rp-input-repsol").removeClass("d-none"):$(".distributor").parent(".input.rp-input-repsol").addClass("d-none"),$(".profesional"))).parent(".input.rp-input-repsol").addClass("d-none")}),s.on("click",".js-send-register-form",function(e){e.preventDefault(),RepsolRegister.submitInfo(s)}),s.on("blur","input[name='password']",function(){Repsol.forms.validate.InputPassword($(this),!0)}),s.on("blur","input[name='passwordConfirm']",function(){Repsol.forms.validate.InputPassword($(this),!0);var e=$(s).find("input[name='passwordConfirm']"),t=$(e).closest(".cmp-form");$(s).find("input[name='passwordConfirm']").val()==$(s).find("input[name='password']").val()?($(e).attr("data-status",!0),t.find(".error-msg-used").addClass("d-none"),t.addClass("valid"),t.removeClass("error")):($(e).attr("data-status",!1),t.find(".error-msg-used").removeClass("d-none"),t.removeClass("valid"),t.addClass("error"))}),s.find("#emailRegister").on("input",function(){Repsol.forms.validate.InputEmail($(this)),"true"==$(this).attr("data-status")&&RepsolRegister.validateGigyaEmail($(this))})}),$("#registerAuxMsgModal").on("show.bs.modal",function(e){$(this).addClass("backdrop")}),$("#registerAuxMsgModal").on("hidden.bs.modal",function(e){var t=$(this),t=(t.removeClass("backdrop"),t.parent().closest(".modal"));0<t.length&&!$(document).find("body").hasClass("modal-open")&&t.hasClass("show")&&$(document).find("body").addClass("modal-open")}),$("#registerAuxMsgModal").on("click",function(e){$(e.target).hasClass("register-aux-msg-modal")&&$(this).modal("hide")}),$("form.validation-code-from").each(function(){let t=$(this);t.on("click",".js-send-register-form",function(e){e.preventDefault(),RepsolRegister.sendCode(t)})}),$("#linkResendCode").on("click",function(e){RepsolRegister.pushResendCode()})},autoSelectCountry:function(){var e=JSON.parse(RepsolRegister.getCookie("country-selected-rp")).countryId;document.querySelector(`.register-component .form-ecommerce-content .register-form select[name="country"] option[data-id="${e.toLowerCase()}"]`).selected=!0},getCookie:function(e){var t,s=e+"=";for(t of decodeURIComponent(document.cookie).split(";")){let e=t;for(;e.startsWith(" ");)e=e.substring(1);if(e.startsWith(s))return e.substring(s.length,e.length)}return""},checkContent:function(e){var t=e.find("input[name='name']"),s=e.find("input[name='surname']"),o=e.find("input[name='email']"),n=e.find("input[name='password']"),a=e.find("select[name='country']"),r=e.find("select[name='user-type']"),i=e.find("input[name='conditions-policies']"),l=e.find("input[name='policy-cesion-consent']");t.val().length&&s.val().length&&o.val().length&&n.val().length&&""!==a.val()&&""!==r.val()&&i.is(":checked")&&l.is(":checked")?e.attr("data-status",!0):e.attr("data-status",!1)},validateGigyaEmail:function(s){var e=$(s).val();gigyaUtilsLubs.services.checkEmailExist(e).then(e=>{var t=$(s).closest(".cmp-form");e?($(s).attr("data-status",!0),t.find(".error-msg-used").addClass("d-none"),t.addClass("valid"),t.removeClass("error"),RepsolRegister.emailNotUsed=!0):($(s).attr("data-status",!1),t.find(".error-msg-used").removeClass("d-none"),t.removeClass("valid"),t.addClass("error"),RepsolRegister.emailNotUsed=!1)}).catch(e=>{console.error("Hubo un error al verificar el email:",e.message)})},submitInfo:function(e){var t=e.find("input[name='name']"),s=e.find("input[name='surname']"),o=e.find("input[name='email']"),n=e.find("input[name='password']"),a=e.find("input[name='passwordConfirm']"),r=e.find("select[name='country']"),i=e.find("select[name='user-type']"),l=e.find("input[name='conditions-policies']"),d=e.find("input[name='policy-cesion-consent']"),s=(t.length&&Repsol.forms.validate.InputName(t),s.length&&Repsol.forms.validate.InputSurname(s),o.length&&(Repsol.forms.validate.InputEmail(o),"true"==$(o).attr("data-status"))&&RepsolRegister.validateGigyaEmail(o),n.length&&Repsol.forms.validate.InputPassword(n,!0),a.length&&n.length&&(a.attr("data-status",!1),(t=a.closest(".cmp-form")).find(".error-msg-required").addClass("d-none"),a.val()==n.val()?(a.attr("data-status",!0),t.addClass("valid"),t.removeClass("error"),t.find(".error-msg-notmatch").addClass("d-none")):(a.attr("data-status",!1),t.removeClass("valid"),t.find(".error-msg-format").removeClass("d-none"),t.find(".error-msg-notmatch").removeClass("d-none"),t.addClass("error"))),r.closest(".cmp-form")),t=(""!==r.val()?(s.find(".error-msg-required").addClass("d-none"),r.attr("data-status","true"),s.addClass("valid"),s.removeClass("error")):(s.find(".error-msg-required").removeClass("d-none"),r.attr("data-status","false"),s.removeClass("valid"),s.addClass("error")),i.closest(".cmp-form")),c=(""!==i.val()?(i.attr("data-status","true"),t.find(".error-msg-required").addClass("d-none"),t.addClass("valid"),t.removeClass("error")):(i.attr("data-status","false"),t.find(".error-msg-required").removeClass("d-none"),t.removeClass("valid"),t.addClass("error")),i.length&&(t=(s=e.find("input[name='ctc']")).closest(".cmp-form"),c=e.find("input[name='userCode']"),t.find(".error-msg-required").addClass("d-none"),"Profesional_Taller"===i.val()?(c.attr("data-status",!1),s.attr("data-status",!0),""!==c.val()?(c.attr("data-status",!0),t.addClass("valid"),t.removeClass("error")):(c.attr("data-status",!1),t.removeClass("valid"),t.find(".error-msg-format").removeClass("d-none"),t.addClass("error"))):"Distribuidor_Cliente"===i.val()?(c.attr("data-status",!0),s.attr("data-status",!1),""!==s.val()&&s.val().length<11?(s.attr("data-status",!0),t.addClass("valid"),t.removeClass("error")):(s.attr("data-status",!1),t.removeClass("valid"),t.find(".error-msg-format").removeClass("d-none"),t.addClass("error"))):(i.attr("data-status",!1),t.removeClass("valid"),t.find(".error-msg-format").removeClass("d-none"),t.addClass("error"))),l.length&&Repsol.forms.validate.CheckLegal(l),d.length&&Repsol.forms.validate.CheckLegal(d),"true"===e.find("input[name='name']").attr("data-status")),s="true"===e.find("input[name='surname']").attr("data-status"),t="true"===o.attr("data-status"),l="true"===n.attr("data-status"),d="true"===a.attr("data-status"),o="true"===r.attr("data-status"),n="true"===i.attr("data-status"),a="true"===e.find("input[name='userCode']").attr("data-status"),r="true"===e.find("input[name='ctc']").attr("data-status");let m=!1;(m=c&&s&&t&&RepsolRegister.emailNotUsed&&l&&d&&o&&n&&a&&r?!0:m)?(e.closest(".form-ecommerce-content").attr("data-status","ok"),RepsolRegister.sendData(e)):RepsolRegister.analytics.error(e)},sendData:function(n){RepsolRegister.setLoader(!0,n);var e=n.find("input[name='name']"),t=n.find("input[name='surname']"),s=n.find("input[name='email']"),o=n.find("input[name='password']"),a=n.find("select[name='country']"),r=n.find("select[name='country']").find("option:selected").data("id"),i=n.find("select[name='user-type']"),l=n.find("input[name='userCode']"),d=n.find("input[name='ctc']");let c=e.val(),m=t.val(),p=s.val(),u=o.val(),g=a.val(),f=r,R=i.val(),v=l.val(),C=d.val(),h=$("html").attr("lang");e={firstName:c,lastName:m,email:RepsolRegister.emailBackUp=p,password:RepsolRegister.passBackUp=u,country:g,countryID:f,userType:R,userCode:v,ctc:C,operation:"create",lang:h},t=JSON.stringify(e),RepsolRegister.getEmailModal(),s=new XMLHttpRequest;s.addEventListener("readystatechange",function(){var e,t,s,o;4===this.readyState&&(200==this.status?0==(o=(e=JSON.parse(this.responseText)).errorCode)||206002==o||206006==o?void 0===e.vToken||void 0===e.UID?console.log("response.vToken or UID undefinded"):(RepsolRegister.vToken=e.vToken,RepsolRegister.uid=e.UID,""!=RepsolRegister.vToken&&""!=RepsolRegister.uid&&(RepsolRegister.setLoader(!1,n),$(".register-block").addClass("hidden"),$(".code-block").removeClass("hidden")),Repsol.Analytics.clickRegister(),RepsolRegister.userIdentity=R+" / "+g,t={method:"site",component_catalogue:"false",component_description:"Register Login Form",component_name:"card de register",customer_type:R,funnel_action:"register_ok",funnel_step:"01",funnel_type:"register_long",service:"Lubricants",user_identity:RepsolRegister.userIdentity},Repsol.AnalyticsRomProd.AccountRegisterRomProd($(this),t)):1==o?(RepsolRegister.setLoader(!1,n),t=o-1,0<(s=$("#registerAuxMsgModal")).length&&0<s.find(".modal-content.modal-case-"+t).length&&(s.find(`.modal-content:not(.modal-case-${t})`).addClass("d-none"),s.find(".modal-content.modal-case-"+t).removeClass("d-none"),s.modal("show")),RepsolRegister.analytics.error(n,e)):2==o?(RepsolRegister.setLoader(!1,n),s=(t=n.find("input[name='ctc']")).closest(".cmp-form"),t.attr("data-status",!1),s.removeClass("valid"),s.find(".error-msg-format").removeClass("d-none"),s.addClass("error")):(RepsolRegister.setLoader(!1,n),RpAlert.msgError(n.attr("data-msg-error")),RepsolRegister.analytics.error(n,e)):(o=JSON.parse(this.responseText),RepsolRegister.setLoader(!1,n),RpAlert.msgError(n.attr("data-msg-error")),RepsolRegister.analytics.error(n,o)))}),s.open("POST",RepsolRegister.url),s.setRequestHeader("Content-Type","application/json"),s.send(t)},sendCode:function(o){var e={code:o.find("input[name='code']").val(),email:RepsolRegister.emailBackUp,vToken:RepsolRegister.vToken,UID:RepsolRegister.uid,operation:"sendCode"},e=JSON.stringify(e),t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){var e,t,s;4===this.readyState&&(200==this.status?(RepsolRegister.pushVerificationCode(RepsolRegister.userIdentity),0==(t=(e=JSON.parse(this.responseText)).errorCode)?(s={loginID:RepsolRegister.emailBackUp,password:RepsolRegister.passBackUp},gigya.accounts.login(s),gigyaUtilsLubs.checkUserIsLogged(),RepsolRegister.hideModal(),location.reload()):(1==t||2==t?(RepsolRegister.setLoader(!1,o),s=t-1,0<(t=$("#registerAuxMsgModal")).length&&0<t.find(".modal-content.modal-case-"+s).length&&(t.find(`.modal-content:not(.modal-case-${s})`).addClass("d-none"),t.find(".modal-content.modal-case-"+s).removeClass("d-none"),t.modal("show"))):(RepsolRegister.setLoader(!1,o),RpAlert.msgError(o.attr("data-msg-error"))),RepsolRegister.analytics.error(o,e))):(s=JSON.parse(this.responseText),RepsolRegister.setLoader(!1,o),RpAlert.msgError(o.attr("data-msg-error")),RepsolRegister.analytics.error(o,s)))}),t.open("POST",RepsolRegister.url),t.setRequestHeader("Content-Type","application/json"),t.send(e)},getInfoUser:function(e,t,s){RepsolRegister.emailBackUp=e,RepsolRegister.uid=t,RepsolRegister.passBackUp=s},resendCode:function(){var e={email:RepsolRegister.emailBackUp,UID:RepsolRegister.uid,operation:"resendCode"},e=JSON.stringify(e);$.ajax({type:"POST",url:RepsolRegister.url,contentType:"application/json",data:e,cache:!1,success:function(e){var t=e.errorCode;0==t?RepsolRegister.vToken=e.vToken:console.log("Error "+t)},error:function(e,t,s){console.log("Error: "+s)}})},getEmailModal:function(){document.getElementById("email-reference-register").textContent=RepsolRegister.emailBackUp},hideModal:function(){var e=document.getElementById("registerLoginModal"),t=document.getElementById("register-login-modal-backdrop");RepsolRegister.getEmailModal(),e.classList.remove("show"),e.classList.remove("hide"),t.classList.remove("show")},resetInfo:function(e){e.find(".cmp-form-text input").val(""),e.find(".cmp-form-text input").attr("data-status","false"),e.closest(".form-ecommerce-content").attr("data-status","ko")},setLoader:function(e,t){let s=$(document).find("body");0<t.closest(".modal").length&&(s=t.closest(".modal")),Repsol.utils.setLoader(e,s)},analytics:{success:function(e,t){e={event:"account_register",funnel_type:"register_long",funnel_action:"create_account_ok",funnel_step:"02",method:"password",component_position:void 0,component_name:"card de login",account_action:"register",service:"tienda",loyalty_cesion:0<e.find("input[name='policy-cesion-consent']").length?e.find("input[name='policy-cesion-consent']").is(":checked")?"true":"false":void 0,loyalty_cesion_terceros:0<e.find("input[name='policy-cesion-third-consent']").length?e.find("input[name='policy-cesion-third-consent']").is(":checked")?"true":"false":void 0};Repsol.Analytics.ES.form(e)},error:function(e,t){t={event:"account_error",error_type:Repsol.Analytics.ES.getErrorType(e),error_description:t&&t.errorMessage?t.errorMessage:Repsol.Analytics.ES.getFormErrorFields(e),funnel_type:"register_long",funnel_action:"register_ko",funnel_step:"01",method:"site",account_action:"register",service:"Lubricants",loyalty_cesion:0<e.find("input[name='policy-cesion-consent']").length?e.find("input[name='policy-cesion-consent']").is(":checked")?"true":"false":void 0,loyalty_cesion_terceros:0<e.find("input[name='policy-cesion-third-consent']").length?e.find("input[name='policy-cesion-third-consent']").is(":checked")?"true":"false":void 0,component_position:void 0,component_name:"card de login"},Repsol.Analytics.ES.form(t),e={method:"site",account_action:"register",component_name:"card de login",error_type:"form_error",error_description:"contact form | campo obligatorio",funnel_action:"register_ko",customer_type:Repsol.AnalyticsRomProd.Getters.getLoggedUserType(),funnel_step:"1",funnel_type:"register_long",service:"lubricantes"};Repsol.AnalyticsRomProd.AccountErrorRomProd($(".register-form"),e)}},pushVerificationCode:function(e){e={method:"site",component_catalogue:"false",component_description:"Register Login Form",component_name:"card de register",funnel_action:"register_ok",funnel_step:"02",funnel_type:"register_long",service:"Lubricants",user_identity:e};Repsol.AnalyticsRomProd.AccountRegisterRomProd($("#AccountRegisterRomProd"),e)},pushResendCode:function(){var e=document.querySelector("#linkResendCode").getAttribute("href"),e={component_catalogue:"false",component_description:"Register Login Form",component_name:"card de register",content_name:"Bienvenido al Portal Lubricantes Repsol",link_domain:window.location.hostname,link_is_cta:"false",link_text:"Haga clic aqui",link_type:"navigation",link_url:e};Repsol.AnalyticsRomProd.linkClickRomProd($("#linkResendCode"),e)}};$(document).ready(function(){RepsolRegister.init()});